<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bluegrass Book</title>
    <link rel="icon" type="image/png" href="images/banjo.png">
    <link rel="apple-touch-icon" href="images/banjo.png">
    <link rel="stylesheet" href="css/style.css">
    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-WZL02N7DQ8"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-WZL02N7DQ8');
    </script>
    <!-- Supabase SDK -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <!-- ABCJS for ABC notation rendering -->
    <script src="https://cdn.jsdelivr.net/npm/abcjs@6/dist/abcjs-basic-min.js"></script>
</head>
<body>
    <!-- Sidebar Navigation -->
    <div id="sidebar" class="sidebar">
        <div class="sidebar-header">
            <span class="sidebar-title">Menu</span>
            <button id="sidebar-close" class="sidebar-close">&times;</button>
        </div>
        <nav class="sidebar-nav">
            <button id="nav-search" class="nav-item active">
                <span class="nav-icon">&#128269;</span>
                <span class="nav-label">Search</span>
            </button>
            <button id="nav-add-song" class="nav-item">
                <span class="nav-icon">&#43;</span>
                <span class="nav-label">Add Song</span>
            </button>
            <button id="nav-favorites" class="nav-item">
                <span class="nav-icon">&#9825;</span>
                <span class="nav-label">Favorites</span>
                <span id="nav-favorites-count" class="nav-badge hidden">0</span>
            </button>
            <div id="nav-lists-container" class="nav-lists">
                <!-- Dynamic: custom list nav items -->
            </div>
            <button id="nav-manage-lists" class="nav-item nav-secondary">
                <span class="nav-icon">&#9881;</span>
                <span class="nav-label">Manage Lists</span>
            </button>
        </nav>
        <div class="sidebar-footer">
            <button id="nav-about" class="sidebar-link">
                <span>&#9432;</span> About
            </button>
            <a href="https://www.patreon.com/c/bluegrassbook" target="_blank" rel="noopener" class="sidebar-link">
                <span>&#10084;</span> Support on Patreon
            </a>
            <a href="https://buymeacoffee.com/michaelbeav" target="_blank" rel="noopener" class="sidebar-link">
                <span>&#9749;</span> Buy me a coffee
            </a>
            <button id="nav-feedback" class="sidebar-link">
                <span>&#9993;</span> Send Feedback
            </button>
            <a href="bluegrass-standards-board.html" class="sidebar-link">
                <span>&#128659;</span> Standards Board
            </a>
        </div>
    </div>
    <div id="sidebar-backdrop" class="sidebar-backdrop hidden"></div>

    <div class="container">
        <header>
            <div class="header-top">
                <button id="hamburger-btn" class="hamburger-btn" title="Menu">
                    <span class="hamburger-icon">&#9776;</span>
                </button>
                <div class="header-spacer"></div>
                <!-- Auth section -->
                <div id="auth-section" class="auth-section">
                    <button id="sign-in-btn" class="auth-btn" title="Sign in with Google">
                        <span class="auth-icon">&#128100;</span>
                        <span class="auth-text">Sign in</span>
                    </button>
                    <div id="user-info" class="user-info hidden">
                        <img id="user-avatar" class="user-avatar" alt="User" referrerpolicy="no-referrer">
                        <span id="user-name" class="user-name"></span>
                    </div>
                </div>
                <div class="feedback-wrapper">
                    <button id="feedback-btn" class="icon-btn" title="Send Feedback">
                        <span>üí¨</span>
                    </button>
                    <div id="feedback-dropdown" class="feedback-dropdown hidden">
                        <div class="feedback-header">üì£ Send Feedback</div>
                        <button class="feedback-option" data-type="song-issue">
                            <span class="feedback-icon">üêõ</span>
                            <span class="feedback-label">Song Display Issue</span>
                        </button>
                        <button class="feedback-option" data-type="search-problem">
                            <span class="feedback-icon">üîç</span>
                            <span class="feedback-label">Search Problem</span>
                        </button>
                        <button class="feedback-option" data-type="app-issue">
                            <span class="feedback-icon">üí•</span>
                            <span class="feedback-label">App Issue</span>
                        </button>
                        <div class="feedback-divider"></div>
                        <button class="feedback-option" data-type="request-song">
                            <span class="feedback-icon">üéµ</span>
                            <span class="feedback-label">Request a Song</span>
                        </button>
                        <button class="feedback-option" data-type="song-correction">
                            <span class="feedback-icon">‚úèÔ∏è</span>
                            <span class="feedback-label">Song Correction</span>
                        </button>
                        <button class="feedback-option" data-type="copyright">
                            <span class="feedback-icon">‚ö†Ô∏è</span>
                            <span class="feedback-label">Copyright Concern</span>
                        </button>
                        <div class="feedback-divider"></div>
                        <button class="feedback-option" data-type="feature-idea">
                            <span class="feedback-icon">üí°</span>
                            <span class="feedback-label">Feature Idea</span>
                        </button>
                        <button class="feedback-option" data-type="general">
                            <span class="feedback-icon">üí¨</span>
                            <span class="feedback-label">General Feedback</span>
                        </button>
                        <div class="feedback-divider"></div>
                        <a href="mailto:bluegrassbook.feedback@gmail.com" class="feedback-option email-option">
                            <span class="feedback-icon">üìß</span>
                            <span class="feedback-label">Email Me</span>
                        </a>
                    </div>
                </div>
                <button id="theme-toggle" class="icon-btn" title="Toggle theme">
                    <span class="icon-sun">&#9728;</span>
                    <span class="icon-moon">&#9790;</span>
                </button>
            </div>
            <h1 class="site-logo">
                <img src="images/bluegrass_book_dark_logo.png" alt="Bluegrass Book">
            </h1>
            <p id="subtitle" class="subtitle">Loading songs...</p>
        </header>

        <div class="search-container">
            <input
                type="text"
                id="search-input"
                placeholder="Search songs, or try: chord:VII prog:I-IV-V"
                autocomplete="off"
            >
            <div class="search-help">
                <div class="tag-dropdown">
                    <button class="tag-dropdown-btn" id="tag-dropdown-btn">Tags ‚ñæ</button>
                    <div class="tag-dropdown-content" id="tag-dropdown-content">
                        <div class="tag-group">
                            <div class="tag-group-label">Genre</div>
                            <label><input type="checkbox" data-tag="Bluegrass"> Bluegrass</label>
                            <label><input type="checkbox" data-tag="ClassicCountry"> Classic Country</label>
                            <label><input type="checkbox" data-tag="OldTime"> Old Time</label>
                            <label><input type="checkbox" data-tag="Gospel"> Gospel</label>
                            <label><input type="checkbox" data-tag="Folk"> Folk</label>
                            <label><input type="checkbox" data-tag="HonkyTonk"> Honky Tonk</label>
                            <label><input type="checkbox" data-tag="Outlaw"> Outlaw</label>
                            <label><input type="checkbox" data-tag="Rockabilly"> Rockabilly</label>
                        </div>
                        <div class="tag-group">
                            <div class="tag-group-label">Vibe</div>
                            <label><input type="checkbox" data-tag="JamFriendly"> Jam Friendly</label>
                            <label><input type="checkbox" data-tag="Modal"> Modal</label>
                            <label><input type="checkbox" data-tag="Jazzy"> Jazzy</label>
                        </div>
                        <div class="tag-group">
                            <div class="tag-group-label">Structure</div>
                            <label><input type="checkbox" data-tag="Instrumental"> Instrumental</label>
                            <label><input type="checkbox" data-tag="Waltz"> Waltz</label>
                        </div>
                    </div>
                </div>
                <span class="search-hint">chord:VII,II</span>
                <span class="search-hint">prog:ii-V-I</span>
            </div>
            <div id="search-stats" class="search-stats"></div>
        </div>

        <div id="results" class="results"></div>

        <!-- Editor Panel -->
        <div id="editor-panel" class="editor-panel hidden">
            <div class="editor-main">
                <div class="editor-input">
                    <div class="metadata-fields">
                        <div class="field-row">
                            <label for="editor-title">Title:</label>
                            <input type="text" id="editor-title" placeholder="Song title">
                        </div>
                        <div class="field-row">
                            <label for="editor-artist">Artist:</label>
                            <input type="text" id="editor-artist" placeholder="Artist name">
                        </div>
                        <div class="field-row">
                            <label for="editor-writer">Writer:</label>
                            <input type="text" id="editor-writer" placeholder="Songwriter(s)">
                        </div>
                        <div id="edit-comment-row" class="field-row hidden">
                            <label for="editor-comment">Edit Comment:</label>
                            <input type="text" id="editor-comment" placeholder="Describe your changes (e.g., fixed chord alignment, added missing verse)">
                        </div>
                    </div>

                    <div class="song-input-container">
                        <label for="editor-content">Song Content (paste chord sheets here):</label>
                        <textarea id="editor-content" placeholder="Paste a song with chords above lyrics, or type in ChordPro format:

G                    C              G
Amazing grace how sweet the sound

Or use inline chords:
[G]Amazing [C]grace how [G]sweet the sound

Blank lines separate verses."></textarea>
                    </div>

                    <div class="editor-help-row">
                        <details class="format-help">
                            <summary>Format Help</summary>
                            <ul>
                                <li><strong>Paste chord sheets</strong> - Chords above lyrics are auto-converted</li>
                                <li><code>[G]</code> - Inline chord before syllable</li>
                                <li><code>[Verse 1]</code> or <code>[Chorus]</code> - Section markers (in pasted text)</li>
                                <li>Blank line = new verse/section</li>
                            </ul>
                        </details>
                        <button id="chordpro-hints-btn" class="hints-btn" type="button">? ChordPro</button>
                    </div>

                    <div class="editor-actions">
                        <button id="editor-copy" class="action-btn">Copy ChordPro</button>
                        <button id="editor-save" class="action-btn">Download .pro</button>
                        <button id="editor-submit" class="action-btn primary">Submit to Songbook</button>
                        <span id="editor-status" class="save-status"></span>
                    </div>
                </div>

                <div class="editor-preview">
                    <div class="preview-header">
                        <h3>Preview</h3>
                        <label class="preview-option">
                            <input type="checkbox" id="editor-nashville">
                            Nashville
                        </label>
                    </div>
                    <div id="editor-preview-content" class="preview-content">
                        <p class="preview-placeholder">Enter a song to see preview...</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- ChordPro Hints Panel -->
        <div id="chordpro-hints-backdrop" class="hints-backdrop hidden"></div>
        <div id="chordpro-hints-panel" class="hints-panel hidden">
            <div class="hints-header">
                <span>ChordPro Quick Reference</span>
                <button id="chordpro-hints-close" class="hints-close">&times;</button>
            </div>
            <div class="hints-content">
                <div class="hint-section">
                    <div class="hint-label">Title & Artist</div>
                    <pre class="hint-code">{meta: title Your Song Title}
{meta: artist Artist Name}
{key: G}</pre>
                </div>
                <div class="hint-section">
                    <div class="hint-label">Verse</div>
                    <pre class="hint-code">{start_of_verse: Verse 1}
Your [G]lyrics with [C]chords
Right be[D]fore each syl[G]lable
{end_of_verse}</pre>
                </div>
                <div class="hint-section">
                    <div class="hint-label">Chorus</div>
                    <pre class="hint-code">{start_of_chorus}
This is the [G]chorus [D]part
{end_of_chorus}</pre>
                </div>
                <div class="hint-section">
                    <div class="hint-label">Chord Formats</div>
                    <pre class="hint-code">[G] [Am] [C/B] [F#m7] [Bb]</pre>
                    <div class="hint-note">Place chord before the syllable</div>
                </div>
            </div>
        </div>

        <!-- About View -->
        <div id="about-view" class="about-view hidden">
            <div class="about-header">
                <button id="about-back-btn" class="back-btn">&larr; Back</button>
            </div>
            <div class="about-content">
                <div class="about-image">
                    <img src="images/Mike.png" alt="Mike">
                </div>
                <div class="about-text">
                    <h1>About</h1>

                    <div class="about-section">
                        <h3>The Project</h3>
                        <p>
                        BluegrassBook.com is a project to help people that love playing bluegrass, americana, and roots music find songs to play, build personal playlists, and contribute songs to our shared corpus.
                        </p>
                        <p>
The ultimate goal for this project is to store the full corpus of bluegrass and roots vocal and instrumental music, make it searchable, discoverable, downloadable and shareable. The proejct source code is avaialble, but not for commercial use (read the license in the source code).
                        </p>
                        <p>
If you want to contribute, your contributions are welcome! Reach out to me, or submit a PR on github. If you want to share feedback with me about what you like or dislike about this, features you want to see, or anything else - please send me an email at bluegrassbook.feedback@gmail.com or submit a bug report / github issue.
                        </p>

                    </div>

                    <div class="about-section">
                        <h3>About Me</h3>
                        <p>
                        Hi! I'm Mike. I'm a data scientist that also happens to love bluegrass. I am a solo developer and built this funded by my own time and money for your free use. Hope we can jam sometime!
                        </p>
                    </div>

                    <div class="about-section">
                        <h3>Links</h3>
                        <div class="about-links">
                            <a href="https://jollyhrothgar.github.io/" target="_blank" rel="noopener" class="about-link">
                                <span class="about-link-icon">&#127760;</span>
                                <span>My Projects</span>
                            </a>
                            <a href="https://github.com/Jollyhrothgar/Bluegrass-Songbook" target="_blank" rel="noopener" class="about-link">
                                <span class="about-link-icon">&#128187;</span>
                                <span>Source Code</span>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="song-view" class="song-view hidden">
            <div class="song-view-header">
                <button id="back-btn" class="back-btn">&larr; Back</button>
                <div class="song-actions">
                    <button id="print-btn" class="icon-btn" title="Print">
                        <span>üñ®Ô∏è</span>
                    </button>
                    <div class="export-wrapper">
                        <button id="copy-btn" class="icon-btn" title="Copy">
                            <span>üìã</span>
                        </button>
                        <div id="copy-dropdown" class="export-dropdown hidden">
                            <button class="export-option" data-action="copy-chordpro">
                                <span>Copy ChordPro</span>
                            </button>
                            <button class="export-option" data-action="copy-text">
                                <span>Copy as Text</span>
                            </button>
                        </div>
                    </div>
                    <div class="export-wrapper">
                        <button id="download-btn" class="icon-btn" title="Download">
                            <span>‚¨áÔ∏è</span>
                        </button>
                        <div id="download-dropdown" class="export-dropdown hidden">
                            <button class="export-option" data-action="download-chordpro">
                                <span>Download .pro</span>
                            </button>
                            <button class="export-option" data-action="download-text">
                                <span>Download .txt</span>
                            </button>
                        </div>
                    </div>
                    <div class="list-picker-wrapper">
                        <button id="list-picker-btn" class="icon-btn" title="Add to list">
                            <span class="list-icon">‚ûï</span>
                        </button>
                        <div id="list-picker-dropdown" class="list-picker-dropdown hidden">
                            <label class="list-option favorites-option">
                                <input type="checkbox" id="favorites-checkbox">
                                <span class="heart-icon">&#9829;</span>
                                <span>Favorites</span>
                            </label>
                            <div class="list-divider"></div>
                            <div id="custom-lists-container">
                                <!-- Dynamic list checkboxes -->
                            </div>
                            <button id="create-list-btn" class="create-list-btn">+ New List</button>
                        </div>
                    </div>
                    <button id="edit-song-btn" class="action-btn">Edit</button>
                    <button id="bug-btn" class="bug-btn">Report Bug</button>
                </div>
            </div>
            <div id="song-content" class="song-content"></div>
        </div>

        <!-- Bug Report Modal -->
        <div id="bug-modal" class="modal hidden">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>Report Parsing Bug</h2>
                    <button id="modal-close" class="modal-close">&times;</button>
                </div>
                <div class="modal-body">
                    <label for="bug-feedback">Describe the issue:</label>
                    <textarea id="bug-feedback" placeholder="e.g., Chord alignment is off in verse 2, missing repeat section, wrong artist name..."></textarea>
                </div>
                <div class="modal-footer">
                    <button id="submit-bug-btn" class="action-btn primary">Submit Bug Report</button>
                    <span id="bug-status" class="copy-status"></span>
                </div>
            </div>
        </div>

        <!-- Contact Modal -->
        <div id="contact-modal" class="modal hidden">
            <div class="modal-content">
                <div class="modal-header">
                    <h2 id="contact-modal-title">Send Feedback</h2>
                    <button id="contact-modal-close" class="modal-close">&times;</button>
                </div>
                <div class="modal-body">
                    <label for="contact-feedback">Describe your feedback:</label>
                    <textarea id="contact-feedback" placeholder="Enter your message here..."></textarea>
                </div>
                <div class="modal-footer">
                    <button id="submit-contact-btn" class="action-btn primary">Submit</button>
                    <span id="contact-status" class="copy-status"></span>
                </div>
            </div>
        </div>

        <!-- Account Modal -->
        <div id="account-modal" class="modal hidden">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>Account</h2>
                    <button id="account-modal-close" class="modal-close">&times;</button>
                </div>
                <div class="modal-body">
                    <div id="account-user-info" class="account-user-info">
                        <img id="account-avatar" class="account-avatar" alt="" referrerpolicy="no-referrer">
                        <div class="account-details">
                            <div id="account-name" class="account-name"></div>
                            <div id="account-email" class="account-email"></div>
                        </div>
                    </div>
                    <div id="sync-status" class="sync-status">
                        <span id="sync-indicator" class="sync-indicator"></span>
                        <span id="sync-text">Favorites synced</span>
                    </div>
                </div>
                <div class="modal-footer">
                    <button id="force-sync-btn" class="action-btn">Sync Now</button>
                    <button id="account-sign-out-btn" class="action-btn danger">Sign Out</button>
                </div>
            </div>
        </div>

        <!-- Manage Lists Modal -->
        <div id="lists-modal" class="modal hidden">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>Manage Lists</h2>
                    <button id="lists-modal-close" class="modal-close">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="create-list-form">
                        <input type="text" id="new-list-name" placeholder="New list name">
                        <button id="create-list-submit" class="action-btn primary">Create</button>
                    </div>
                    <div id="lists-container" class="lists-container">
                        <!-- Dynamic list items -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Version Picker Modal -->
        <div id="version-modal" class="modal hidden">
            <div class="modal-content version-picker">
                <div class="modal-header">
                    <h2 id="version-modal-title">Select Version</h2>
                    <button id="version-modal-close" class="modal-close">&times;</button>
                </div>
                <div class="modal-body">
                    <div id="version-list" class="version-list">
                        <!-- Dynamic version items -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="js/supabase-auth.js"></script>
    <script src="js/search.js"></script>
</body>
</html>
